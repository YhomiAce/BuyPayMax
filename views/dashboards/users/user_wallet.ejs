<!-- header -->
<%- include("../../partials/header") %>
<%- include("../../partials/user_sidebar") %>
<!-- Main Content -->
<div class="main-content">
    <%- include("../../partials/alerts") %>
    <section class="section">
        <div class="row ">
            <div class="col-lg-4 col-md-6 col-sm-6 col-12">
               
            </div>
            
           
            
    </section>

    <section class="section" style="background: #eee; padding: 5%;">

        <div class="row container-fluid">
            <div class="col-lg-12 " style="padding: 2% 7%;">
                <form action="" method="post">
                    <h3 class="text-center">Sell Coin</h3>
                    <div class="form-group">
                        <label for="amount">Amount</label>
                        <input type="number" step="0.00001" placeholder="Enter Amount" value="" required class="form-control text-center" id="deposit"
                        name="deposit">
                    </div>
                    <input type="hidden" id="user_email" value="<%= email %>">
                    <input type="hidden" id="user_phone" value="09000202020">
                    <div class="form-group">
                        <select name="coin" id="coin" class="form-control">
                            <option value="" disabled selected>Select Coin</option>
                            <% for(let i=0; i< products.length; i++) { %> 
                            <option value="<%= products[i].id  %>"><%= products[i].name  %></option>
                            <% } %> 
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center">
            <div class="row">
                <div class="col-lg-4 col-md-6">
                    <label for="">Pay with Crypto</label>
                    <button type="button" class="btn btn-dark btn-block btn-lg"
                    data-toggle="modal" id = "payBtn" data-target="#payNow">Sell Coin</button>
                </div>
                <div class="col-lg-4 col-md-6">
                    
                </div>
            </div>

            <!-- arrange the payment platforms into sections
        from paystack, crypto, and deposits -->
    </section>
    <div class="modal fade" id="payNow" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <!-- <h4 class="modal-title" id="myCenterModalLabel">Payment for: </h4> -->
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                </div>
                <div class="modal-body">
                    <center>
                        <img src="https://chart.googleapis.com/chart?chs=300x300&amp;cht=qr&amp;chl=1B2GbofYB6Y3D39f4Ag6aDCWJUcxgyRuwC" class="img-fluid">
                        <p class="text-muted font-16" id="statement"></p>
                        <h3 class="mb-0">Wallet Address</h3>
                        <input id="walletAddress"  class="text-muted font-18 form-control text-center border-0 bg-white" value="" readonly="">
                        <p class="text-muted font-13 mt-1">
                           
                            <form action="/fundwallet" method="POST">
                                <input type="hidden" name="email" value="<%= email  %> " >
                                <input type="hidden" id="walletAddressId" name="walletAddressId" value="<%= email  %> " >
                                <input type="text" id="amount" class="text-muted font-18 form-control text-center border-0 bg-white" name="amount" readonly value="" >
                                <input type="text" id="channel" class="text-muted font-18 form-control text-center border-0 bg-white" readonly name="channel" value="" >
                                <button class="btn btn-info" id="confirmPayment">Confirm Payment</button></p>
                        </form>
                           
                    </center>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
</div>
<%- include("../../partials/user_footer2") %>

<!-- bitmint scripts -->
<script src="https://js.paystack.co/v1/inline.js"></script>
<script src="https://js.paylot.co/v1/inline.min.js"></script>
<script src="/js/payments.js"></script>
<script>
    $(document).ready(()=>{
        // var walletType = $('#coin').find(":selected").val();
        $("#payBtn").click(()=>{
            var amount = $("#deposit").val();
            $('#amount').val(amount);
            
        })
        $('#coin').change(()=>{
                var walletType = $("#coin").val();
                var channel = $("#coin option:selected").text();
                console.log(channel);
                console.log($("#coin").val());
                $.ajax({
                    method:'get',
                    url:`/free/wallet/${walletType}`,
                    success: (res =>{
                        console.log(res);
                        const add = JSON.stringify(res);
                        // console.log(add);
                        var address =res.wallet.walletAddress;
                        console.log(address);
                        $("#walletAddress").val(address);
                        $('#channel').val(channel);
                        var wallId = res.wallet.id
                        $("#walletAddressId").val(wallId)
                    })
                })
            })
        
        
    })
</script>
</body>

</html>